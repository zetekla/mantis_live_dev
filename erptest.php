<?php
require_once ( 'core.php' );
	
$test_subject = 'Email from: Steve Yang <SteveYang@eminc.com>

<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta name="Generator" content="Microsoft Word 14 (filtered medium)">
<!--[if !mso]><style>v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style><![endif]--><style><!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Microsoft Sans Serif";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"Berlin Sans FB Demi";
	panose-1:2 14 8 2 2 5 2 2 3 6;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-priority:99;
	mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-priority:99;
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
span.EmailStyle20
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
span.EmailStyle21
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:#1F497D;
	font-weight:normal;
	font-style:normal;}
span.EmailStyle22
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
span.EmailStyle23
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
span.EmailStyle24
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
span.EmailStyle25
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:765804275;
	mso-list-type:hybrid;
	mso-list-template-ids:458779318 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l0:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l0:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext="edit" spidmax="1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext="edit">
<o:idmap v:ext="edit" data="1" />
</o:shapelayout></xml><![endif]-->
</head>
<body lang="EN-US" link="blue" vlink="purple">
<div class="WordSection1">
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<div>
<div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in">
<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;">From:</span></b><span style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;"> Steve Yang
<br>
<b>Sent:</b> Wednesday, August 31, 2016 5:58 PM<br>
<b>To:</b> Tram Vu; Steve Yang<br>
<b>Cc:</b> 3519-PRODUCTION; Production_Request; Luong Lam; Michael Rodriguez; Chindavone Douangphouxay; Mui Tan; Andrew Lechuga<br>
<b>Subject:</b> RE: Wycom/Cubic S/O#194975 Assy#184530-1<o:p></o:p></span></p>
</div>
</div>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal"><span style="color:#1F497D">Tram,</span><o:p></o:p></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">The boards with ds1 discoloration that are failing test need to be replaced.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Please follow the following instructions:<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoListParagraph" style="text-indent:-.25in;mso-list:l0 level1 lfo2"><![if !supportLists]><span style="color:#1F497D"><span style="mso-list:Ignore">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style="color:#1F497D">De-solder and remove ds1<o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent:-.25in;mso-list:l0 level1 lfo2"><![if !supportLists]><span style="color:#1F497D"><span style="mso-list:Ignore">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style="color:#1F497D">Clean area as needed<o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent:-.25in;mso-list:l0 level1 lfo2"><![if !supportLists]><span style="color:#1F497D"><span style="mso-list:Ignore">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style="color:#1F497D">Install/solder new ds1 component using leaded no clean process<o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent:-.25in;mso-list:l0 level1 lfo2"><![if !supportLists]><span style="color:#1F497D"><span style="mso-list:Ignore">4.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style="color:#1F497D">Inspect new ds1 reworked boards<o:p></o:p></span></p>
<p class="MsoListParagraph" style="text-indent:-.25in;mso-list:l0 level1 lfo2"><![if !supportLists]><span style="color:#1F497D"><span style="mso-list:Ignore">5.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style="color:#1F497D">Continue into production<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Please notify me when the rework process begins.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Thank you<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">steve<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<div>
<div style="border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in 0in 0in">
<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;">From:</span></b><span style="font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;"> Michael Rodriguez
<br>
<b>Sent:</b> Thursday, August 11, 2016 8:58 AM<br>
<b>To:</b> Tram Vu<br>
<b>Cc:</b> 3519-PRODUCTION; Production_Request; Steve Yang; Luong Lam<br>
<b>Subject:</b> RE: Wycom/Cubic S/O#194975 Assy#184530-1<o:p></o:p></span></p>
</div>
</div>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal"><span style="color:#1F497D">Tram,<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Lam showed me the boards and this is not good. We will check the taping process.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Thanks.<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D">Mike<o:p></o:p></span></p>
<p class="MsoNormal"><span style="color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<div>
<div style="border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in">
<p class="MsoNormal"><b>From:</b> Tram Vu <br>
<b>Sent:</b> Thursday, August 11, 2016 2:42 AM<br>
<b>To:</b> Michael Rodriguez &lt;<a href="mailto:MRodriguez@eminc.com">MRodriguez@eminc.com</a>&gt;<br>
<b>Cc:</b> 3519-PRODUCTION &lt;<a href="mailto:3519-PRODUCTION@eminc.com">3519-PRODUCTION@eminc.com</a>&gt;; Production_Request &lt;<a href="mailto:PRequest@eminc.com">PRequest@eminc.com</a>&gt;; Steve Yang &lt;<a href="mailto:SteveYang@eminc.com">SteveYang@eminc.com</a>&gt;;
 Luong Lam &lt;<a href="mailto:LuongLam@eminc.com">LuongLam@eminc.com</a>&gt;<br>
<b>Subject:</b> Wycom/Cubic S/O#194975 Assy#184530-1<o:p></o:p></p>
</div>
</div>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal">Mike,<o:p></o:p></p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal">Production has around 60 boards that conformal coating go to DS1. Please advise is it okay or not?<o:p></o:p></p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal"><img border="0" width="555" height="214" id="Picture_x0020_2" src="cid:image001.jpg@01D203B1.3E722B50"><o:p></o:p></p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Berlin Sans FB Demi&quot;,&quot;sans-serif&quot;;color:#17365D">Thank you!!!<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;Berlin Sans FB Demi&quot;,&quot;sans-serif&quot;;color:#17365D">Tram<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:#1F497D"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:#1F497D"><img border="0" width="372" height="44" id="Picture_x0020_1" src="cid:image002.png@01D203B1.3E722B50" alt="cid:image001.png@01D18089.14E1C3F0"><o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:#1F497D">3519 West Warner Avenue<o:p></o:p></span></p>
<p class="MsoNormal"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:#1F497D">Santa Ana, CA 92704
<o:p></o:p></span></p>
<p class="MsoNormal" style="margin-right:3.25in;vertical-align:baseline"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:black;letter-spacing:-.4pt">Email:&nbsp;
<a href="mailto:TramVu@eminc.com">TramVu@eminc.com</a><o:p></o:p></span></p>
<p class="MsoNormal" style="margin-top:1.0pt;vertical-align:baseline"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:black;letter-spacing:-.25pt">Website:
</span><span style="color:#1F497D"><a href="http://www.eminc.com/"><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;letter-spacing:-.25pt">http://www.eminc.com</span></a><o:p></o:p></span></p>
<p class="MsoNormal" style="margin-top:1.0pt;vertical-align:baseline"><u><span style="font-size:9.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:blue;letter-spacing:-.25pt"><o:p><span style="text-decoration:none">&nbsp;</span></o:p></span></u></p>
<p class="MsoNormal" style="margin-top:1.0pt;vertical-align:baseline"><span style="font-size:10.0pt;font-family:&quot;Arial&quot;,&quot;sans-serif&quot;;color:#9D0559;letter-spacing:.85pt">AS9100C; ISO9001; ISO13485 Certified; ITAR Registered.<o:p></o:p></span></p>
<p class="MsoNormal" style="margin-top:1.0pt;vertical-align:baseline"><span style="font-size:9.0pt;font-family:&quot;Microsoft Sans Serif&quot;,&quot;sans-serif&quot;;color:#9D0559;letter-spacing:.85pt"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="text-align:justify"><span style="font-size:9.0pt;color:black">Information that is determined to be export controlled shall not be transmitted, disclosed, or provided to any non US Persons. It is the responsibility of all recipients
 to ensure the included information cannot be legally shared with another party.<o:p></o:p></span></p>
<p class="MsoNormal"><o:p>&nbsp;</o:p></p>
</div>
</body>
</html>';	
ECHO $test_subject;
echo '<br>================================================================<br>';
	function build_reply($t_subject)
	{
		//pattern to slip off html head data
		$pattern = '/<![endif]--\>\\n<\/head>/';
		//$pattern = '/<\![endif]-->\n</head>/';
		//split initial email message body to split off html head data
		$subject = preg_split ( $pattern , $t_subject , -1 );
		//print_r ($subject);
		//echo '<br> breaker1 <br>';
		//pattern to remove from message body
		$pattern = '/<p class="MsoNormal"><o:p>&nbsp;<\/o:p><\/p>/';
		$replacement ='';
		//delete some MSO formatting
		$subject = preg_replace ( $pattern , $replacement , $subject[0], -1 );
		//print_r ($subject);
		//echo '<br> breaker2 <br>';
		$pattern = '/<o:p><\/o:p>/';
		//delete some MSO formatting
		$subject = preg_replace ( $pattern , $replacement , $subject, -1 );	
		//echo ($subject);
		//echo '<br> breaker3 <br>';
		//pattern to split messages in email body
		$pattern = '/<div style="border:none;border-top:solid #[0-9a-zA-Z]{6} 1.0pt;padding:3.0pt 0in 0in 0in">/';
		$replies = preg_split ( $pattern , $subject, -1 );
		//print_r ($replies);
		//echo '<br> breaker4 <br>';
		return $replies;
	}
		
echo 'Test<br>========================================================<br>';

$replies = build_reply($test_subject);
$t_bug_id = '168';
$t_description = $replies[1];
$p_email[ 'Thread-Index' ] = 'AdIS1x84lVbywFVwSEu3if+pg27/nQ';
print_r($replies) ;
echo '<br>========================================================<br>';
echo ($p_email[ 'Thread-Index' ]);
echo '<br>========================================================<br>';
	$t_bugnote_id = bugnote_add( $t_bug_id, $t_description, $p_email[ 'Thread-Index' ]);
    if ( !$t_bugnote_id ) {
        error_parameters( lang_get( 'bugnote' ) );
        trigger_error( ERROR_EMPTY_FIELD, ERROR );
		echo "FAILED";
    }
echo $t_bugnote_id;
//bugnote_add( $t_bug_id, $t_description, $p_email[ 'Thread-Index' ]);


	?>